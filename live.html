<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title></title>
		<!--<link rel="stylesheet" href="css/app.css" />-->
		<link rel="stylesheet" href="http://lyg.goluckin.com/themes/css/app.css" />
		<link href="http://gz.ybinu.cn/video5.18/css/video-js.css" rel="stylesheet">
		<script src="http://gz.ybinu.cn/video5.18/js/video.min.js"></script>
    	<script src="http://gz.ybinu.cn/video5.18/js/videojs-ie8.min.js"></script>
	</head>
	
	<body>
		<div class="main">
			<div class="flex just-between">
				<div class="gs-title">
					<span class="gs-live-in">直播未开始</span><?=$userinfo['uid']?> 角色<?=$userinfo['roleName']?>
				</div>
				<div class="color-fff" style="font-size: 14px;">欢迎您,<?=$userinfo['name']?></div>
			</div>
			<div class="content flex">
				<div class="content-left">
					<div class="content-left-top back">
						<video id="my-video2" style="color:black;width:100%;height:100%" class="video-js" autoplay controls preload="auto" width="750" height="350" data-setup="{}">
							<source src="rtmp://no3.ybinu.cn:1935/hls/0" type="rtmp/flv">
							<!--<source src="rtmp://ns8.indexforce.com/home/mystream" type="rtmp/flv">-->
						</video>
						<embed width="300" height="70" class="openFlash" style="position:absolute;top:0;z-Index:9999;" type="application/x-shockwave-flash">
					</div>
					<div class="content-left-bottom back mt-10 flex flex-column">
						<div>
							<div class="flex just-between gs-userlist-count color-fff">
								<div>问答</div>
								<div>
									<input type="checkbox">只看我
								</div>
							</div>
						</div>
						<div class="flex1"></div>
						<div class="color-fff quiz">
							专家为你解答疑惑
							<div style="margin-top: 10px;">
								<textarea></textarea>
								<input class="btn" type="button" value="提问">
							</div>
						</div>
					</div>
				</div>
				<div class="flex1 ml-10 flex flex-column">
					<div class="content-center back flex just-center align-center">
						<!-- <img src="./img/doc_bg.png" style="width: 260px;"> -->
						<video id="my-video" style="color:black;width:100%;height:100%" class="video-js" autoplay controls preload="auto" width="750" height="350" data-setup="{}">
							<source src="rtmp://no3.ybinu.cn:1935/hls/111111" type="rtmp/flv">
							<!--<source src="rtmp://ns8.indexforce.com/home/mystream" type="rtmp/flv">-->
						</video>
						<embed width="300" height="70" class="openFlash" style="position:absolute;z-Index:9999;" type="application/x-shockwave-flash">
					</div>
					<div class="content-bottom back mt-10"></div>
				</div>
				<div class="content-right back ml-10">
					<div class="flex flex-column" style="height: 100%;">
						<div>
							<div class="flex just-between gs-userlist-count color-fff">
								<div>聊天</div>
								<div>
									<input type="checkbox">只看我
								</div>
							</div>
						</div>
						<div class="flex stutent-list">
							<ul id="subList"></ul>
						</div>
						<div class="color-fff quiz">
							发表评论
							<div style="margin-top: 10px;">
								<textarea id="send"></textarea>
								<input class="btn" id="btn" type="button" value="发送">
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		</div>
	</body>
	<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
	<script type="text/javascript" src="http://lyg.goluckin.com/themes/js/common.js" ></script>
	<!--<script type="text/javascript" src="js/common.js" ></script>-->
	<script type="text/javascript">
		$(function(){
			var roomid='26'; //房间号
			var isBottom=true; //是否刷新到底部
			var times=''; //计时器
			fetch(); //初始化聊天列表
			fetchStuent(); //初始化学生直播窗口
			function fetch(){
				$.get(API+"chatContent",{
					roomid:roomid
				},function(res){
					typeof res =="string" && (res=JSON.parse(res));
					var html='';
					res.data.forEach(function(item){
						html+=`<li class="flex">
								<div>
									<img src="http://lyg.goluckin.com/themes/v2/static/images/17yk.png"  style="width: 40px;"/>
								</div>
								<div>
									<div class="title">${item.chatname} [${item.ctime}]</div>
									<div class="title_content">${item.chatcontent}</div>
								</div>
							</li>`
					})
					$("#subList").html(html);
					if(isBottom){
						$(".stutent-list").animate({scrollTop:$(".stutent-list")[0].scrollHeight},400);
						isBottom=false;
					}else{
						var sLT=$(".stutent-list")[0].scrollTop;
						var sLSH=$(".stutent-list")[0].scrollHeight;
						var sLH=$(".stutent-list").height();
						if(sLT>sLSH-sLH) {
							$(".stutent-list").animate({scrollTop:sLSH},400);
						};
					}
					times=setTimeout(function(){
						fetch();
					},2000)
				})
			}
			//学生窗口
			function fetchStuent(){
				$.get(API+"getstuadr",{
					roomid:roomid
				},function(res){
					typeof res =="string" && (res=JSON.parse(res));
					if(res.url){
						$("#my-video2 source").attr("src",res.url)
					}
					setTimeout(function(){
						fetchStuent();
					},4000)
				})
			}
			//监听发送回车
			$("#send").on('keydown',function(e){
	            if(e.keyCode!=13){
	                return;
	            }else{//当按键输入为回车时，执行下列操作
	                event.preventDefault();//为了兼容IE8
	                e.returnValue = false;
	                send();
	            }
	        });
	        //发送按钮
	        $("#btn").on("click",function(){
	        	send();
	        })
	        //发送消息
	        function send(){
	        	var sendVal= $("#send").val();
	        	if(sendVal==''){
	        		alert("发送不能为空！")
	        		return;
	        	}
	        	$.get(API+"sendmsg",{
	        		roomid:roomid,
	        		userid:'ff045dd98a4e479887d2bf168ee0548f',
	        		content:sendVal
	        	},function(res){
					typeof res =="string" && (res=JSON.parse(res));
					if(res.status!=200){
						alert(res.msg);
						return;
					}
					$("#send").val('');
					isBottom=true;
					clearTimeout(times);
					fetch();
				})
	        }
		})
		
	</script>
</html>